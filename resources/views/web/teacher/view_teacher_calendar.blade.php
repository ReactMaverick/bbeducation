<div class="row">
    <div class="col-md-12 col-xl-1 col-lg-1 col-12 col-sm-12">
        <div class="teacher-calendar-sidebar-section new_teacher-calendar-sidebar ">
            <div class="form-check sidebar-mode-check">
                <label class="teacher_svg" for="viewMode1">
                    <svg xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink"
                        width="512" height="512" x="0" y="0" viewBox="0 0 96 96"
                        style="enable-background:new 0 0 512 512" xml:space="preserve" class="">
                        <g>
                            <path
                                d="M18.294 92h10.893c1.711 0 3.099-1.289 3.099-3s-1.387-3-3.099-3H18.294C13.708 86 10 81.93 10 77.169V33h75v11.282c0 1.711 1.789 3.099 3.5 3.099s3.5-1.387 3.5-3.099V18.894C92 10.821 84.413 4 76.426 4H18.294C10.291 4 4 10.681 4 18.894v58.275C4 85.347 10.291 92 18.294 92zM10 18.894C10 14.18 13.786 10 18.294 10h58.132C81.053 10 85 14.18 85 18.894V27H10z"
                                fill="#000000" opacity="1" data-original="#000000" class=""></path>
                            <path
                                d="M74.427 16h-1.239c-1.711 0-3.099 1.789-3.099 3.5s1.387 3.5 3.099 3.5h1.239c1.711 0 3.099-1.789 3.099-3.5S76.138 16 74.427 16zM63.892 16h-1.239c-1.711 0-3.099 1.789-3.099 3.5s1.387 3.5 3.099 3.5h1.239c1.711 0 3.099-1.789 3.099-3.5S65.603 16 63.892 16zM52.737 16h-1.239c-1.711 0-3.099 1.789-3.099 3.5s1.387 3.5 3.099 3.5h1.239c1.711 0 3.099-1.789 3.099-3.5S54.448 16 52.737 16zM60.997 47.135C47.409 47.135 35 55.668 30 68.369c0 0 6.505 23.954 30.997 23.432C86.875 91.25 92 68.369 92 68.369c-5-12.701-17.411-21.234-31.003-21.234zm.221 38.469c-10.634 0-20.346-6.437-24.536-16.136 4.189-9.699 13.902-16.136 24.536-16.136 10.637 0 20.351 6.437 24.541 16.136-4.189 9.699-13.904 16.136-24.541 16.136z"
                                fill="#000000" opacity="1" data-original="#000000" class=""></path>
                            <path
                                d="M61.221 57.445c-6.63 0-12.024 5.393-12.024 12.023s5.394 12.023 12.024 12.023 12.023-5.393 12.023-12.023-5.393-12.023-12.023-12.023zm0 17.849c-3.213 0-5.827-2.614-5.827-5.826s2.614-5.826 5.827-5.826 5.826 2.614 5.826 5.826-2.613 5.826-5.826 5.826z"
                                fill="#000000" opacity="1" data-original="#000000" class=""></path>
                        </g>
                    </svg>
                </label>
                <input type="radio" id="viewMode1" name="calendar_mode1" value="view" checked>
            </div>
            <div class="form-check sidebar-mode-check">
                <label class="teacher_svg" for="addMode1">
                    <svg xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink"
                        width="512" height="512" x="0" y="0" viewBox="0 0 24 24"
                        style="enable-background:new 0 0 512 512" xml:space="preserve" class="">
                        <g>
                            <path
                                d="M18 2c2.206 0 4 1.794 4 4v12c0 2.206-1.794 4-4 4H6c-2.206 0-4-1.794-4-4V6c0-2.206 1.794-4 4-4zm0-2H6a6 6 0 0 0-6 6v12a6 6 0 0 0 6 6h12a6 6 0 0 0 6-6V6a6 6 0 0 0-6-6z"
                                fill="#000000" opacity="1" data-original="#000000" class=""></path>
                            <path d="M12 18a1 1 0 0 1-1-1V7a1 1 0 0 1 2 0v10a1 1 0 0 1-1 1z" fill="#000000"
                                opacity="1" data-original="#000000" class=""></path>
                            <path d="M6 12a1 1 0 0 1 1-1h10a1 1 0 0 1 0 2H7a1 1 0 0 1-1-1z" fill="#000000"
                                opacity="1" data-original="#000000" class=""></path>
                        </g>
                    </svg>
                </label>
                <input type="radio" id="addMode1" name="calendar_mode1" value="add">
            </div>
            <div class="form-check sidebar-mode-check">
                <label class="teacher_svg" for="editMode1">
                    <svg xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink"
                        width="512" height="512" x="0" y="0" viewBox="0 0 511.964 511.964"
                        style="enable-background:new 0 0 512 512" xml:space="preserve" class="">
                        <g>
                            <path
                                d="M503.225 8.735C492.813-1.676 476.04-2.939 464.208 5.799l-263.13 194.366a7.496 7.496 0 0 0-1.576 10.489 7.5 7.5 0 0 0 10.489 1.577L473.119 17.865c5.91-4.364 14.293-3.729 19.499 1.477s5.841 13.588 1.477 19.497c-.757 1.027-183.829 248.867-207.043 280.295L186.907 218.99a7.5 7.5 0 0 0-10.607 0 37.217 37.217 0 0 0-8.423 12.896l-21.9 55.821c-7.752-2.445-16.575-.606-22.71 5.529-6.202 6.202-8.013 15.151-5.447 22.964l-66.45 28.479a7.498 7.498 0 0 0-4.134 4.442S1.437 481.574 1.283 482.127c-2.865 8.203-.818 17.113 5.312 23.242 6.118 6.118 15.025 8.172 23.27 5.352l132.977-45.994a7.496 7.496 0 0 0 4.442-4.134l28.479-66.45c7.813 2.566 16.762.755 22.964-5.447 6.134-6.135 7.973-14.957 5.529-22.709l55.799-21.892a37.218 37.218 0 0 0 12.919-8.432 37.642 37.642 0 0 0 3.777-4.411S505.96 48.005 506.133 47.731c8.766-11.81 7.504-28.583-2.908-38.996zM154.804 451.634 26.587 495.982l49.862-49.862c8.362 3.984 18.691 2.523 25.604-4.391l21.213-21.213c8.773-8.773 8.773-23.047 0-31.82s-23.047-8.773-31.82 0l-21.213 21.213c-6.914 6.914-8.375 17.242-4.391 25.604l-49.844 49.844c4.686-13.581 37.869-109.519 44.329-128.198l66.529-28.513 56.459 56.459zm-73.963-31.119 21.213-21.213c2.924-2.924 7.682-2.924 10.607 0 2.924 2.924 2.924 7.682 0 10.607l-21.213 21.213c-2.924 2.924-7.682 2.924-10.607 0s-2.925-7.683 0-10.607zm127.279-42.427c-2.924 2.925-7.682 2.925-10.607 0l-63.64-63.64c-2.924-2.924-2.924-7.682 0-10.607 2.924-2.924 7.682-2.924 10.607 0l63.64 63.64c2.924 2.925 2.924 7.683 0 10.607zm66.478-47.967-59.343 23.282-56.696-56.696 23.291-59.365c.203-.522.424-1.033.662-1.534l93.642 93.642c-.508.241-1.027.465-1.556.671z"
                                fill="#000000" opacity="1" data-original="#000000" class=""></path>
                        </g>
                    </svg>
                </label>
                <input type="radio" id="editMode1" name="calendar_mode1" value="edit">
            </div>
            <div class="form-check sidebar-mode-check">
                <label class="teacher_svg" for="asnEditMode1">
                    <svg xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink"
                        width="512" height="512" x="0" y="0" viewBox="0 0 401.523 401"
                        style="enable-background:new 0 0 512 512" xml:space="preserve" class="">
                        <g>
                            <path
                                d="M370.59 250.973c-5.524 0-10 4.476-10 10v88.789c-.02 16.562-13.438 29.984-30 30H50c-16.563-.016-29.98-13.438-30-30V89.172c.02-16.559 13.438-29.98 30-30h88.79c5.523 0 10-4.477 10-10 0-5.52-4.477-10-10-10H50c-27.602.031-49.969 22.398-50 50v260.594c.031 27.601 22.398 49.968 50 50h280.59c27.601-.032 49.969-22.399 50-50v-88.793c0-5.524-4.477-10-10-10zm0 0"
                                fill="#3c0077ad" opacity="1" data-original="#3c0077ad" class=""></path>
                            <path
                                d="M376.629 13.441c-17.574-17.574-46.067-17.574-63.64 0L134.581 191.848a9.997 9.997 0 0 0-2.566 4.402l-23.461 84.7a9.997 9.997 0 0 0 12.304 12.308l84.7-23.465a9.997 9.997 0 0 0 4.402-2.566l178.402-178.41c17.547-17.587 17.547-46.055 0-63.641zM156.37 198.348 302.383 52.332l47.09 47.09-146.016 146.016zm-9.406 18.875 37.62 37.625-52.038 14.418zM374.223 74.676 363.617 85.28l-47.094-47.094 10.61-10.605c9.762-9.762 25.59-9.762 35.351 0l11.739 11.734c9.746 9.774 9.746 25.59 0 35.36zm0 0"
                                fill="#3c0077ad" opacity="1" data-original="#3c0077ad" class=""></path>
                        </g>
                    </svg>
                </label>
                <input type="radio" id="asnEditMode1" name="calendar_mode1" value="asnEdit">
            </div>
        </div>
    </div>

    <div class="col-md-12 col-12 col-lg-8 col-xl-8 col-sm-12">
        <div id='full_calendar_events'></div>
    </div>

    <div class="col-md-12 col-12 col-sm-12 col-xl-3 col-lg-3">
        <div>
            <label>Calendar Item For</label>
            <p id="calItemFor"></p>
        </div>
        <div>
            <label>Type</label>
            <p id="calType"></p>
        </div>
        <div>
            <label>Notes</label>
            <p id="calNotes"></p>
        </div>
        <div>
            <label>Quick Set</label>
            <select class="form-control" name="" id="calQuickSet">
                <option value="">Default - (Cycle)</option>
                @foreach ($quickList as $key1 => $quick)
                    <option value="{{ $quick->description_int }}">
                        {{ $quick->description_txt }}
                    </option>
                @endforeach
            </select>
        </div>
    </div>
</div>

<!-- multiple asn Modal -->
<div class="modal fade" id="multipleTeacherAsnModal" data-backdrop="static">
    <div class="modal-dialog modal-lg modal-dialog-centered calendar-modal-section">
        <div class="modal-content calendar-modal-content">

            <!-- Modal Header -->
            <div class="modal-header calendar-modal-header">
                <h4 class="modal-title">Multiple Teacher Assignment Dates</h4>
                <button type="button" class="close" id="multipleTeacherAsnClose">&times;</button>
            </div>

            <div class="modal-body">
                <div class="col-md-12 mt-2">
                    <table class="table table-bordered table-striped">
                        <thead>
                            <tr class="table-heading add-school-teacher-table">
                                <th>School</th>
                                <th>Day Part</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody class="table-body-sec" id="multipleTeacherAsnTable">

                        </tbody>
                    </table>
                </div>
            </div>

        </div>
    </div>
</div>
<!-- multiple asn Modal -->

<script>
    $(document).ready(function() {
        var SITEURL = "{{ url('/') }}";
        var teacher_id = "{{ $teacher_id }}";
        $.ajaxSetup({
            headers: {
                'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
            }
        });
        var defAsnId = '';
        var calendar = $('#full_calendar_events').fullCalendar({
            editable: false,
            firstDay: 1,
            header: {
                left: 'prev',
                center: 'today, title',
                right: 'next'
            },
            // weekends: [ 0, 6 ],
            fixedWeekCount: false,
            showNonCurrentDates: false,
            fullDay: false,
            events: SITEURL + "/calendarListByTeacher/" + teacher_id,
            displayEventTime: false,
            // eventColor: '#cdb71e',
            eventTextColor: '#fff',
            eventBackgroundColor: '#ffa601',
            eventRender: function(event, element, view) {
                if (event.reason_int == 2 || event.reason_int == 3) {
                    // element.css('background-color', '#37a6ff');
                    element.addClass('new-event-color-4');
                } else if (event.reason_int == 4) {
                    // element.css('background-color', '#304556');
                    element.addClass('new-event-color-3');
                } else if (event.reason_int == 5) {
                    // element.css('background-color', '#9ca1a5');
                    element.addClass('new-event-color-2');
                } else {
                    // element.css('background-color', '#ffa601');
                    element.addClass('new-event-color-1');
                }
                if (event.link_id) {
                    defAsnId = event.link_id;
                }
                event.editable = true;
                element.find('span.fc-title').addClass('customClass');
            },
            selectable: true,
            selectHelper: true,
            dragScroll: false,
            unselectAuto: false,
            droppable: false,
            allDayDefault: false,
            longPressDelay: 1,
            select: function(event_start, event_end, allDay) {
                if ((event_end._d.getDate() - 1) != event_start._d.getDate()) {
                    calendar.fullCalendar('unselect');
                } else {
                    var event_start = $.fullCalendar.formatDate(event_start, "Y-MM-DD");
                    var viewDate = '';
                    var viewNote = '';
                    var viewEventId = '';
                    var asnItem_id = '';
                    var calendarItem_id = '';
                    var eAsnList = [];
                    $.ajax({
                        url: SITEURL + "/teacherEventExist",
                        data: {
                            teacher_id: teacher_id,
                            event_start: event_start
                        },
                        type: "POST",
                        dataType: "json",
                        async: false,
                        success: function(data) {
                            // console.log(data);
                            if (data) {
                                viewDate = data.date;
                                if (data.status == true) {
                                    if (data.calEventItem.reason_int == 6) {
                                        viewNote = data.calEventItem.tc_notes_txt;
                                    } else {
                                        if (data.calEventItem.calendarItem_id) {
                                            viewNote = data.calEventItem.tc_notes_txt;
                                        } else {
                                            viewNote = data.calEventItem.title;
                                        }
                                    }
                                    viewEventId = data.calEventItem.link_id;
                                    asnItem_id = data.calEventItem.asnItem_id;
                                    calendarItem_id = data.calEventItem.calendarItem_id;
                                    eAsnList = data.calEventItem.e_asn_list;
                                }
                            }
                        }
                    });

                    var calendar_mode1 = $('input[name="calendar_mode1"]:checked').val();
                    if (calendar_mode1 == 'view') {
                        $('#calItemFor').html('');
                        $('#calNotes').html('');
                        $('#calItemFor').html(viewDate);
                        if (viewNote) {
                            $('#calNotes').html(viewNote.split(':')[1] ? viewNote.split(':')[1] :
                                viewNote);
                        } else {
                            $('#calNotes').html(viewNote);
                        }
                    }

                    if (calendar_mode1 == 'add') {
                        var calQuickSet = $('#calQuickSet').val();
                        $.ajax({
                            url: SITEURL + "/teacherCalEventAdd",
                            data: {
                                teacher_id: teacher_id,
                                event_start: event_start,
                                asnItem_id: asnItem_id,
                                calendarItem_id: calendarItem_id,
                                calQuickSet: calQuickSet
                            },
                            type: "POST",
                            dataType: "json",
                            async: false,
                            success: function(data) {
                                calendar.fullCalendar('refetchEvents');
                                calendar.fullCalendar('unselect');
                            }
                        });
                    }

                    if (calendar_mode1 == 'asnEdit') {
                        if ((eAsnList).length > 1) {
                            var tableHtml = '';
                            $.each(eAsnList, function(index, value) {
                                var tUrl = "{{ url('/assignment-details') }}" + "/" + value
                                    .asn_id;
                                tableHtml +=
                                    '<tr class="table-data clickable-row" data-url=' +
                                    tUrl +
                                    '> <td>' + value
                                    .name_txt + '</td> <td>' + value.title + '</td> <td>' +
                                    value.yearGroup + '</td> </tr>';
                            });
                            $('#multipleTeacherAsnTable').html(tableHtml);
                            $('#multipleTeacherAsnModal').modal("show");
                        } else {
                            if (viewEventId) {
                                var rUrl2 = '<?php echo url('/assignment-details/'); ?>' + '/' + viewEventId;
                                window.open(rUrl2, '_blank');
                            } else if (defAsnId) {
                                var rUrl2 = '<?php echo url('/assignment-details/'); ?>' + '/' + defAsnId;
                                window.open(rUrl2, '_blank');
                            }
                        }
                    }

                    if (calendar_mode1 == 'edit' && calendarItem_id) {
                        $.ajax({
                            url: SITEURL + "/teacherEventEdit",
                            data: {
                                calendarItem_id: calendarItem_id
                            },
                            type: "POST",
                            dataType: "json",
                            async: false,
                            success: function(data) {
                                if (data) {
                                    $('#AjaxTeacherCalEvent').html(data.html);
                                    $('#TeacherCalEventEditModal').modal("show");
                                }
                            }
                        });
                    }
                }
            },
            eventClick: function(event) {
                // var event_start = $.fullCalendar.formatDate(event_start, "Y-MM-DD");
                // console.log(event);
                var calendar_mode1 = $('input[name="calendar_mode1"]:checked').val();
                if (calendar_mode1 == 'view') {
                    var eDate = event.start.format();
                    $('#calItemFor').html('');
                    $('#calNotes').html('');
                    $('#calItemFor').html(moment(eDate).format("ddd DD MMM YYYY"));
                    var viewNote = '';
                    if (event.reason_int == 6) {
                        viewNote = event.tc_notes_txt;
                    } else {
                        if (event.calendarItem_id) {
                            viewNote = event.tc_notes_txt;
                        } else {
                            viewNote = event.title;
                        }
                    }
                    if (viewNote) {
                        $('#calNotes').html(viewNote.split(':')[1] ? viewNote.split(':')[1] :
                            viewNote);
                    } else {
                        $('#calNotes').html(viewNote);
                    }
                }

                if (calendar_mode1 == 'asnEdit') {
                    if ((event.e_asn_list).length > 1) {
                        var tableHtml = '';
                        $.each(event.e_asn_list, function(index, value) {
                            var tUrl = "{{ url('/assignment-details') }}" + "/" + value
                                .asn_id;
                            tableHtml +=
                                '<tr class="table-data clickable-row" data-url=' + tUrl +
                                '> <td>' + value
                                .name_txt + '</td> <td>' + value.title + '</td> <td>' +
                                value.yearGroup + '</td> </tr>';
                        });
                        $('#multipleTeacherAsnTable').html(tableHtml);
                        $('#multipleTeacherAsnModal').modal("show");
                    } else {
                        if (event.link_id) {
                            var rUrl3 = '<?php echo url('/assignment-details/'); ?>' + '/' + event.link_id;
                            window.open(rUrl3, '_blank');
                        } else if (defAsnId) {
                            var rUrl3 = '<?php echo url('/assignment-details/'); ?>' + '/' + defAsnId;
                            window.open(rUrl3, '_blank');
                        }
                    }
                }

                if (calendar_mode1 == 'add') {
                    var calQuickSet = $('#calQuickSet').val();
                    var eDate = event.start.format();
                    $.ajax({
                        url: SITEURL + "/teacherCalEventAdd",
                        data: {
                            teacher_id: teacher_id,
                            event_start: eDate,
                            asnItem_id: event.asnItem_id,
                            calendarItem_id: event.calendarItem_id,
                            calQuickSet: calQuickSet
                        },
                        type: "POST",
                        dataType: "json",
                        async: false,
                        success: function(data) {
                            calendar.fullCalendar('refetchEvents');
                            calendar.fullCalendar('unselect');
                        }
                    });
                }

                if (calendar_mode1 == 'edit' && event.calendarItem_id) {
                    $.ajax({
                        url: SITEURL + "/teacherEventEdit",
                        data: {
                            calendarItem_id: event.calendarItem_id
                        },
                        type: "POST",
                        dataType: "json",
                        async: false,
                        success: function(data) {
                            if (data) {
                                $('#AjaxTeacherCalEvent').html(data.html);
                                $('#TeacherCalEventEditModal').modal("show");
                            }
                        }
                    });
                }
            }
        });
    });

    $(document).on('click', '#multipleTeacherAsnClose', function() {
        $('#multipleTeacherAsnModal').modal("hide");
        $('body').addClass('modal-open');
    });

    $(document).ready(function() {
        $('#multipleTeacherAsnTable').on('click', '.clickable-row', function() {
            var url = $(this).data('url');
            window.open(url, '_blank');
        });
    });
</script>
